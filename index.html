<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¿ƒæ„é­”æ³•å¡ V2.0</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #1a1a1a; font-family: 'Microsoft JhengHei', sans-serif; user-select: none; }
        
        /* 1. ä¸»é¸å–® (é¦–é ) */
        #main-menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; background: #000; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 80%; height: 80%; }
        .category-btn { border: none; border-radius: 20px; font-size: clamp(24px, 4vw, 40px); font-weight: bold; color: #fff; cursor: pointer; transition: transform 0.2s; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .category-btn:active { transform: scale(0.95); }
        
        /* é¡è‰²å®šç¾© */
        .btn-bday { background: linear-gradient(135deg, #FF69B4, #FF1493); border: 4px solid #FFB6C1; } /* ç”Ÿæ—¥ */
        .btn-thank { background: linear-gradient(135deg, #40E0D0, #00CED1); border: 4px solid #AFEEEE; } /* æ„Ÿè¬ */
        .btn-xmas { background: linear-gradient(135deg, #228B22, #006400); border: 4px solid #90EE90; } /* è–èª• */
        .btn-cny { background: linear-gradient(135deg, #FF0000, #8B0000); border: 4px solid #FFD700; } /* æ–°å¹´ */

        /* 2. ç¹ªåœ–ä»‹é¢ */
        #game-interface { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        canvas { display: block; background: #000; touch-action: none; }

        /* å·¥å…·åˆ— (å³å´) */
        #toolbar { position: absolute; right: 0; top: 0; width: 120px; height: 100%; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 20px; gap: 15px; border-left: 2px solid #555; }
        
        .tool-btn { width: 90px; height: 90px; border-radius: 15px; background: #333; border: 3px solid #555; font-size: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; position: relative; }
        .tool-btn.active { border-color: #FFD700; background: #555; transform: scale(1.1); box-shadow: 0 0 15px #FFD700; }
        .tool-label { position: absolute; bottom: 5px; font-size: 14px; color: white; width: 100%; text-align: center; pointer-events: none; text-shadow: 1px 1px 2px black;}

        /* åŠŸèƒ½æŒ‰éˆ•å€ (å·¦ä¸‹) */
        #actions { position: absolute; bottom: 20px; left: 20px; display: flex; gap: 15px; }
        .action-btn { background: #444; color: white; border: 2px solid white; padding: 10px 20px; font-size: 20px; border-radius: 30px; cursor: pointer; }
        .btn-back { background: #FF4500; }
        .btn-save { background: #1E90FF; }
        
        /* æ¨™é¡Œæç¤º */
        #canvas-title { position: absolute; top: 20px; left: 20px; color: rgba(255,255,255,0.5); font-size: 24px; pointer-events: none; }

    </style>
</head>
<body>

    <div id="main-menu">
        <h1 style="color:white; margin-bottom: 20px; font-size: 3rem;">ğŸ¨ å¿ƒæ„é­”æ³•å¡</h1>
        <div class="menu-grid">
            <button class="category-btn btn-bday" onclick="startGame('birthday')">
                <span>ğŸ‚</span> ç”Ÿæ—¥å¡
            </button>
            <button class="category-btn btn-thank" onclick="startGame('thankyou')">
                <span>ğŸ’–</span> æ„Ÿè¬å¡
            </button>
            <button class="category-btn btn-xmas" onclick="startGame('xmas')">
                <span>ğŸ„</span> è–èª•å¡
            </button>
            <button class="category-btn btn-cny" onclick="startGame('cny')">
                <span>ğŸ§§</span> æ–°å¹´è³€å¡
            </button>
        </div>
    </div>

    <div id="game-interface">
        <div id="canvas-title"></div>
        <canvas id="artCanvas"></canvas>
        
        <div id="toolbar">
            </div>

        <div id="actions">
            <button class="action-btn btn-back" onclick="goBack()">â†© è¿”å›</button>
            <button class="action-btn" onclick="clearCanvas()">ğŸ—‘ï¸ æ¸…é™¤</button>
            <button class="action-btn btn-save" onclick="saveCard()">ğŸ“· å„²å­˜</button>
        </div>
    </div>

<script>
    // --- è³‡æ–™è¨­å®šï¼šå››å¤§ä¸»é¡Œèˆ‡å°æ‡‰å·¥å…· ---
    const themes = {
        birthday: {
            name: "ç”Ÿæ—¥å¿«æ¨‚",
            bg: "#1a0510", // æ·±ç²‰ç´…é»‘
            tools: [
                { id: 'cake', icon: 'ğŸ‚', label: 'è›‹ç³•', type: 'stamp', size: 60 },
                { id: 'balloon', icon: 'ğŸˆ', label: 'æ°£çƒ', type: 'stamp', size: 50 },
                { id: 'ribbon', icon: 'ã€°ï¸', label: 'å½©å¸¶', type: 'brush', color: '#FF69B4', width: 10 },
                { id: 'text', icon: 'A', label: 'ç”Ÿæ—¥å¿«æ¨‚', type: 'text', content: 'ç”Ÿæ—¥å¿«æ¨‚!', color: '#FFD700' }
            ]
        },
        thankyou: {
            name: "æ„Ÿè¬å¿ƒæ„",
            bg: "#05151a", // æ·±è—ç¶ é»‘
            tools: [
                { id: 'flower', icon: 'ğŸŒ¸', label: 'èŠ±æœµ', type: 'stamp', size: 50 },
                { id: 'heart', icon: 'ğŸ’–', label: 'æ„›å¿ƒ', type: 'stamp', size: 50 },
                { id: 'star', icon: 'âœ¨', label: 'é–ƒå…‰', type: 'brush', color: '#00FFFF', width: 5 },
                { id: 'text', icon: 'A', label: 'Thank You', type: 'text', content: 'Thank You', color: '#FFFFFF' }
            ]
        },
        xmas: {
            name: "è–èª•å¿«æ¨‚",
            bg: "#051a05", // æ·±ç¶ é»‘
            tools: [
                { id: 'tree', icon: 'ğŸ„', label: 'è–èª•æ¨¹', type: 'stamp', size: 70 },
                { id: 'santa', icon: 'ğŸ…', label: 'è–èª•äºº', type: 'stamp', size: 60 },
                { id: 'snow', icon: 'â„ï¸', label: 'é›ªèŠ±', type: 'brush', color: '#FFFFFF', width: 8 },
                { id: 'text', icon: 'A', label: 'Merry Xmas', type: 'text', content: 'Merry Xmas', color: '#FF0000' }
            ]
        },
        cny: {
            name: "è¾²æ›†æ–°å¹´",
            bg: "#2b0a0a", // æ·±ç´…é»‘
            tools: [
                { id: 'lantern', icon: 'ğŸ®', label: 'ç‡ˆç± ', type: 'stamp', size: 60 },
                { id: 'fuk', icon: 'ğŸ§§', label: 'åˆ©æ˜¯', type: 'stamp', size: 50 },
                { id: 'gold', icon: 'ğŸŸ¡', label: 'é‡‘ç²‰', type: 'brush', color: '#FFD700', width: 15 },
                { id: 'text', icon: 'A', label: 'ç¦', type: 'text', content: 'ç¦', color: '#FFD700' }
            ]
        }
    };

    // --- è®Šæ•¸ ---
    let currentThemeId = '';
    let currentTool = null;
    const canvas = document.getElementById('artCanvas');
    const ctx = canvas.getContext('2d');
    let width, height;

    // --- éŸ³æ•ˆç³»çµ± (åˆæˆéŸ³) ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function playTone(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;

        if (type === 'select') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, now);
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
            osc.start(now); osc.stop(now + 0.2);
        } else if (type === 'draw') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(300 + Math.random()*200, now);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.1);
            osc.start(now); osc.stop(now + 0.1);
        }
    }

    // --- æ ¸å¿ƒé‚è¼¯ ---

    function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
        // å¦‚æœæ­£åœ¨éŠæˆ²ä¸­ï¼Œé‡ç¹ªèƒŒæ™¯
        if(currentThemeId) clearCanvas(false); 
    }
    window.addEventListener('resize', resize);

    function startGame(themeId) {
        currentThemeId = themeId;
        const theme = themes[themeId];
        
        // åˆ‡æ›ä»‹é¢
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('game-interface').style.display = 'block';
        document.getElementById('canvas-title').innerText = "æ­£åœ¨è£½ä½œ: " + theme.name;
        
        resize();
        clearCanvas(true); // è¨­ç½®èƒŒæ™¯è‰²

        // ç”Ÿæˆå·¥å…·åˆ—
        const toolbar = document.getElementById('toolbar');
        toolbar.innerHTML = '';
        theme.tools.forEach((tool, index) => {
            const btn = document.createElement('div');
            btn.className = 'tool-btn';
            if (index === 0) { // é è¨­é¸ä¸­ç¬¬ä¸€å€‹
                btn.classList.add('active');
                currentTool = tool;
            }
            btn.innerHTML = `${tool.icon}<div class="tool-label">${tool.label}</div>`;
            btn.onclick = () => selectTool(tool, btn);
            toolbar.appendChild(btn);
        });
    }

    function selectTool(tool, btnElement) {
        currentTool = tool;
        // æ›´æ–° UI
        document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
        btnElement.classList.add('active');
        playTone('select');
    }

    function goBack() {
        document.getElementById('game-interface').style.display = 'none';
        document.getElementById('main-menu').style.display = 'flex';
        currentThemeId = '';
    }

    function clearCanvas(resetBg = true) {
        if (!currentThemeId) return;
        ctx.fillStyle = themes[currentThemeId].bg;
        ctx.fillRect(0, 0, width, height);
        if(!resetBg) playTone('select');
    }

    // --- ç¹ªåœ–è™•ç† ---
    let isDrawing = false;
    let lastX = 0, lastY = 0;

    function draw(x, y) {
        if (!currentTool) return;

        // éš¨æ©Ÿæ•£å°„ä¸€é»é»ï¼Œè®“çœ¼å‹•å„€çš„æŠ–å‹•è®Šæˆè—è¡“æ•ˆæœ
        const jitter = 5; 
        const dx = (Math.random() - 0.5) * jitter;
        const dy = (Math.random() - 0.5) * jitter;
        x += dx; y += dy;

        playTone('draw');

        if (currentTool.type === 'stamp') {
            // é™åˆ¶å°ç« å¯†åº¦ï¼Œé¿å…é‡ç–Šå¤ªå¯†
            if (Math.random() > 0.1) return; 
            ctx.font = `${currentTool.size}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(currentTool.icon, x, y);
        } 
        else if (currentTool.type === 'text') {
             if (Math.random() > 0.05) return; // æ–‡å­—å‡ºç¾é »ç‡ä½ä¸€é»
            ctx.font = `bold 40px Microsoft JhengHei`;
            ctx.fillStyle = currentTool.color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowColor = "black";
            ctx.shadowBlur = 4;
            ctx.fillText(currentTool.content, x, y);
            ctx.shadowBlur = 0;
        }
        else if (currentTool.type === 'brush') {
            // é€£çºŒç·šæ¢ / ç²’å­åˆ·
            ctx.beginPath();
            ctx.arc(x, y, currentTool.width, 0, Math.PI * 2);
            ctx.fillStyle = currentTool.color;
            ctx.shadowBlur = 10;
            ctx.shadowColor = currentTool.color;
            ctx.fill();
            ctx.shadowBlur = 0;
        }
    }

    function handleStart(x, y) { isDrawing = true; draw(x, y); }
    function handleMove(x, y) { if (isDrawing) draw(x, y); }
    function handleEnd() { isDrawing = false; }

    // äº‹ä»¶ç›£è½ (æ”¯æ´ Mouse / Touch / Eye Tracker Mouse Emulation)
    canvas.addEventListener('mousedown', e => handleStart(e.clientX, e.clientY));
    canvas.addEventListener('mousemove', e => handleMove(e.clientX, e.clientY));
    canvas.addEventListener('mouseup', handleEnd);

    canvas.addEventListener('touchstart', e => {
        e.preventDefault();
        for (let i = 0; i < e.touches.length; i++) handleStart(e.touches[i].clientX, e.touches[i].clientY);
    }, {passive: false});

    canvas.addEventListener('touchmove', e => {
        e.preventDefault();
        for (let i = 0; i < e.touches.length; i++) handleMove(e.touches[i].clientX, e.touches[i].clientY);
    }, {passive: false});

    function saveCard() {
        const link = document.createElement('a');
        link.download = `card-${currentThemeId}.png`;
        link.href = canvas.toDataURL();
        link.click();
        playTone('select');
    }
    
    // åˆå§‹åŒ–
    resize();
</script>
</body>
</html>