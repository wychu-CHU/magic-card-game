<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¿ƒæ„é­”æ³•å¡ V4.0</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #1a1a1a; font-family: 'Microsoft JhengHei', sans-serif; user-select: none; }
        
        /* 1. ä¸»é¸å–® (é¦–é ) */
        #main-menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; background: #000; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 85%; height: 65%; }
        .category-btn { border: none; border-radius: 20px; font-size: clamp(20px, 3.5vw, 32px); font-weight: bold; color: #fff; cursor: pointer; transition: transform 0.2s; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .category-btn:active { transform: scale(0.95); }
        
        /* é¡è‰²å®šç¾© */
        .btn-bday { background: linear-gradient(135deg, #FF69B4, #FF1493); border: 4px solid #FFB6C1; }
        .btn-thank { background: linear-gradient(135deg, #40E0D0, #00CED1); border: 4px solid #AFEEEE; }
        .btn-xmas { background: linear-gradient(135deg, #228B22, #006400); border: 4px solid #90EE90; }
        .btn-cny { background: linear-gradient(135deg, #FF0000, #8B0000); border: 4px solid #FFD700; }

        /* è¨­å®šæŒ‰éˆ• */
        #settings-btn { position: absolute; top: 20px; right: 20px; font-size: 24px; background: #333; color: white; border: 2px solid #777; padding: 10px 20px; border-radius: 30px; cursor: pointer; }
        
        /* è¨­å®šé¢æ¿ */
        #settings-modal { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; background: #222; border: 4px solid #FFD700; border-radius: 20px; padding: 20px; z-index: 20; color: white; text-align: center; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        .setting-row { margin: 20px 0; }
        .slider { width: 100%; height: 15px; border-radius: 5px; background: #555; outline: none; -webkit-appearance: none; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 25px; height: 25px; border-radius: 50%; background: #FFD700; cursor: pointer; }
        .close-settings { background: #444; color: white; border: none; padding: 10px 30px; font-size: 18px; border-radius: 10px; cursor: pointer; margin-top: 10px; }

        /* 2. ç¹ªåœ–ä»‹é¢ */
        #game-interface { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        canvas { display: block; background: #000; touch-action: none; }

        /* å·¥å…·åˆ— (å³å´) - å„ªåŒ–æ»¾å‹•æ¢ */
        #toolbar { position: absolute; right: 0; top: 0; width: 110px; height: 100%; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 10px; gap: 10px; border-left: 2px solid #555; overflow-y: auto; padding-bottom: 20px; }
        
        /* éš±è— Scrollbar ä½†ä¿æŒæ»¾å‹•åŠŸèƒ½ (Chrome/Safari) */
        #toolbar::-webkit-scrollbar { width: 0px; background: transparent; }
        /* Firefox */
        #toolbar { scrollbar-width: none; }

        .tool-btn { width: 80px; height: 80px; flex-shrink: 0; border-radius: 15px; background: #333; border: 3px solid #555; font-size: 35px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; position: relative; }
        .tool-btn.active { border-color: #FFD700; background: #555; transform: scale(1.05); box-shadow: 0 0 15px #FFD700; }
        .tool-label { position: absolute; bottom: 2px; font-size: 12px; color: white; width: 100%; text-align: center; pointer-events: none; text-shadow: 1px 1px 2px black; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; padding: 0 2px;}

        /* åŠŸèƒ½æŒ‰éˆ•å€ */
        #actions { position: absolute; bottom: 20px; left: 20px; display: flex; gap: 15px; }
        .action-btn { background: #444; color: white; border: 2px solid white; padding: 10px 20px; font-size: 20px; border-radius: 30px; cursor: pointer; }
        .btn-back { background: #FF4500; }
        .btn-save { background: #1E90FF; }
        
        #canvas-title { position: absolute; top: 20px; left: 20px; color: rgba(255,255,255,0.5); font-size: 24px; pointer-events: none; }
        
        /* æ»¾å‹•æç¤º (å¦‚æœå·¥å…·å¤ªå¤š) */
        .scroll-hint { position: absolute; bottom: 5px; right: 0; width: 110px; text-align: center; color: rgba(255,255,255,0.5); font-size: 10px; pointer-events: none; }
    </style>
</head>
<body>

    <div id="main-menu">
        <button id="settings-btn" onclick="openSettings()">âš™ï¸ è¨­å®š</button>
        <h1 style="color:white; margin-bottom: 20px; font-size: 3rem;">ğŸ¨ å¿ƒæ„é­”æ³•å¡ V4</h1>
        <div class="menu-grid">
            <button class="category-btn btn-bday" onclick="startGame('birthday')"><span>ğŸ‚</span>ç”Ÿæ—¥å¡</button>
            <button class="category-btn btn-thank" onclick="startGame('thankyou')"><span>ğŸ’–</span>æ„Ÿè¬å¡</button>
            <button class="category-btn btn-xmas" onclick="startGame('xmas')"><span>ğŸ„</span>è–èª•å¡</button>
            <button class="category-btn btn-cny" onclick="startGame('cny')"><span>ğŸ§§</span>æ–°å¹´è³€å¡</button>
        </div>
    </div>

    <div id="settings-modal">
        <h2>ğŸ”§ éŠæˆ²è¨­å®š</h2>
        <div class="setting-row">
            <label>åœ–æ¡ˆå¤§å°: <span id="size-val">100%</span></label>
            <br><br>
            <input type="range" min="0.5" max="3.0" step="0.1" value="1.0" class="slider" id="size-slider" oninput="updateSettings()">
        </div>
        <div class="setting-row">
            <label>éŸ³æ•ˆéŸ³é‡</label>
            <br><br>
            <input type="range" min="0" max="1" step="0.1" value="0.5" class="slider" id="vol-slider" oninput="updateSettings()">
        </div>
        <button class="close-settings" onclick="closeSettings()">âœ… å®Œæˆ</button>
    </div>

    <div id="game-interface">
        <div id="canvas-title"></div>
        <canvas id="artCanvas"></canvas>
        <div id="toolbar"></div>
        <div class="scroll-hint">â–¼ æ»‘å‹•æ›´å¤š</div>
        <div id="actions">
            <button class="action-btn btn-back" onclick="goBack()">â†© è¿”å›</button>
            <button class="action-btn" onclick="clearCanvas()">ğŸ—‘ï¸ æ¸…é™¤</button>
            <button class="action-btn btn-save" onclick="saveCard()">ğŸ“· å„²å­˜</button>
        </div>
    </div>

<script>
    // --- è³‡æ–™è¨­å®šï¼šæ¯å€‹ä¸»é¡Œæ“´å……è‡³ 12 å€‹å·¥å…· ---
    const themes = {
        birthday: {
            name: "ç”Ÿæ—¥å¿«æ¨‚",
            bg: "#1a0510",
            tools: [
                { id: 'cake', icon: 'ğŸ‚', label: 'è›‹ç³•', type: 'stamp', size: 60 },
                { id: 'candle', icon: 'ğŸ•¯ï¸', label: 'è Ÿç‡­', type: 'stamp', size: 55 },
                { id: 'balloon', icon: 'ğŸˆ', label: 'æ°£çƒ', type: 'stamp', size: 55 },
                { id: 'gift', icon: 'ğŸ', label: 'ç¦®ç‰©', type: 'stamp', size: 55 },
                { id: 'crown', icon: 'ğŸ‘‘', label: 'çš‡å† ', type: 'stamp', size: 60 },
                { id: 'cupcake', icon: 'ğŸ§', label: 'ç”œé»', type: 'stamp', size: 50 },
                { id: 'candy', icon: 'ğŸ­', label: 'æ³¢æ¿ç³–', type: 'stamp', size: 50 },
                { id: 'party', icon: 'ğŸ¥³', label: 'é–‹å¿ƒ', type: 'stamp', size: 50 },
                { id: 'confetti', icon: 'ğŸŠ', label: 'æ‹‰ç‚®', type: 'stamp', size: 60 },
                { id: 'music', icon: 'ğŸµ', label: 'éŸ³æ¨‚', type: 'stamp', size: 50 },
                { id: 'ribbon', icon: 'ã€°ï¸', label: 'å½©å¸¶', type: 'brush', color: '#FF69B4', width: 12 },
                { id: 'text', icon: 'A', label: 'ç”Ÿæ—¥å¿«æ¨‚', type: 'text', content: 'ç”Ÿæ—¥å¿«æ¨‚!', color: '#FFD700' }
            ]
        },
        thankyou: {
            name: "æ„Ÿè¬å¿ƒæ„",
            bg: "#05151a",
            tools: [
                { id: 'flower', icon: 'ğŸŒ¸', label: 'æ«»èŠ±', type: 'stamp', size: 50 },
                { id: 'rose', icon: 'ğŸŒ¹', label: 'ç«ç‘°', type: 'stamp', size: 50 },
                { id: 'bouquet', icon: 'ğŸ’', label: 'èŠ±æŸ', type: 'stamp', size: 60 },
                { id: 'heart', icon: 'ğŸ’–', label: 'æ„›å¿ƒ', type: 'stamp', size: 50 },
                { id: 'like', icon: 'ğŸ‘', label: 'è®š', type: 'stamp', size: 50 },
                { id: 'medal', icon: 'ğŸ¥‡', label: 'é‡‘ç‰Œ', type: 'stamp', size: 55 },
                { id: 'trophy', icon: 'ğŸ†', label: 'çç›ƒ', type: 'stamp', size: 60 },
                { id: 'sun', icon: 'ğŸŒ', label: 'é™½å…‰', type: 'stamp', size: 60 },
                { id: 'rainbow', icon: 'ğŸŒˆ', label: 'å½©è™¹', type: 'stamp', size: 70 },
                { id: 'smile', icon: 'ğŸ˜Š', label: 'ç¬‘è‡‰', type: 'stamp', size: 50 },
                { id: 'star', icon: 'âœ¨', label: 'é–ƒå…‰', type: 'brush', color: '#00FFFF', width: 6 },
                { id: 'text', icon: 'A', label: 'Thank You', type: 'text', content: 'Thank You', color: '#FFFFFF' }
            ]
        },
        xmas: {
            name: "è–èª•å¿«æ¨‚",
            bg: "#051a05",
            tools: [
                { id: 'tree', icon: 'ğŸ„', label: 'è–èª•æ¨¹', type: 'stamp', size: 70 },
                { id: 'santa', icon: 'ğŸ…', label: 'è–èª•äºº', type: 'stamp', size: 60 },
                { id: 'deer', icon: 'ğŸ¦Œ', label: 'é¦´é¹¿', type: 'stamp', size: 60 },
                { id: 'snowman', icon: 'â›„', label: 'é›ªäºº', type: 'stamp', size: 60 },
                { id: 'sock', icon: 'ğŸ§¦', label: 'è–èª•è¥ª', type: 'stamp', size: 55 },
                { id: 'cookie', icon: 'ğŸª', label: 'è–‘é¤…', type: 'stamp', size: 50 },
                { id: 'bell', icon: 'ğŸ””', label: 'éˆ´éº', type: 'stamp', size: 50 },
                { id: 'star_tree', icon: 'ğŸŒŸ', label: 'æ˜Ÿæ˜Ÿ', type: 'stamp', size: 55 },
                { id: 'box', icon: 'ğŸ“¦', label: 'åŒ…è£¹', type: 'stamp', size: 55 },
                { id: 'scarf', icon: 'ğŸ§£', label: 'åœå·¾', type: 'stamp', size: 55 },
                { id: 'snow', icon: 'â„ï¸', label: 'é›ªèŠ±', type: 'brush', color: '#FFFFFF', width: 8 },
                { id: 'text', icon: 'A', label: 'Merry Xmas', type: 'text', content: 'Merry Xmas', color: '#FF0000' }
            ]
        },
        cny: {
            name: "è¾²æ›†æ–°å¹´",
            bg: "#2b0a0a",
            tools: [
                { id: 'dragon', icon: 'ğŸ²', label: 'é¾é ­', type: 'stamp', size: 70 },
                { id: 'lantern', icon: 'ğŸ®', label: 'ç‡ˆç± ', type: 'stamp', size: 60 },
                { id: 'fuk_pkt', icon: 'ğŸ§§', label: 'åˆ©æ˜¯', type: 'stamp', size: 50 },
                { id: 'firecracker', icon: 'ğŸ§¨', label: 'ç‚®ä»—', type: 'stamp', size: 60 },
                { id: 'ingot', icon: 'ğŸ’°', label: 'å…ƒå¯¶', type: 'stamp', size: 55 },
                { id: 'coin', icon: 'ğŸª™', label: 'é‡‘å¹£', type: 'stamp', size: 50 },
                { id: 'orange', icon: 'ğŸŠ', label: 'å¤§å‰', type: 'stamp', size: 55 },
                { id: 'peach', icon: 'ğŸ‘', label: 'å£½æ¡ƒ', type: 'stamp', size: 55 },
                { id: 'dumpling', icon: 'ğŸ¥Ÿ', label: 'é¤ƒå­', type: 'stamp', size: 55 },
                { id: 'fish', icon: 'ğŸŸ', label: 'æœ‰é­š', type: 'stamp', size: 60 },
                { id: 'gold', icon: 'ğŸŸ¡', label: 'é‡‘ç²‰', type: 'brush', color: '#FFD700', width: 15 },
                { id: 'text', icon: 'A', label: 'ç¦', type: 'text', content: 'ç¦', color: '#FFD700' }
            ]
        }
    };

    // --- å…¨å±€è¨­å®š ---
    let sizeMultiplier = 1.0;
    let volumeLevel = 0.5;

    function openSettings() { document.getElementById('settings-modal').style.display = 'block'; }
    function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }
    function updateSettings() {
        sizeMultiplier = parseFloat(document.getElementById('size-slider').value);
        volumeLevel = parseFloat(document.getElementById('vol-slider').value);
        document.getElementById('size-val').innerText = Math.round(sizeMultiplier * 100) + "%";
    }

    // --- æ ¸å¿ƒè®Šæ•¸ ---
    let currentThemeId = '';
    let currentTool = null;
    const canvas = document.getElementById('artCanvas');
    const ctx = canvas.getContext('2d');
    let width, height;

    // --- éŸ³æ•ˆç³»çµ± ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function playTone(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        if (volumeLevel <= 0) return;

        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        const vol = (type === 'select' ? 0.3 : 0.1) * volumeLevel;

        if (type === 'select') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, now);
            gain.gain.setValueAtTime(vol, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
            osc.start(now); osc.stop(now + 0.2);
        } else if (type === 'draw') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(300 + Math.random()*200, now);
            gain.gain.setValueAtTime(vol, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.1);
            osc.start(now); osc.stop(now + 0.1);
        }
    }

    // --- éŠæˆ²é‚è¼¯ ---
    function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
        if(currentThemeId) clearCanvas(false); 
    }
    window.addEventListener('resize', resize);

    function startGame(themeId) {
        currentThemeId = themeId;
        const theme = themes[themeId];
        
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('game-interface').style.display = 'block';
        document.getElementById('canvas-title').innerText = "æ­£åœ¨è£½ä½œ: " + theme.name;
        
        resize();
        clearCanvas(true);

        const toolbar = document.getElementById('toolbar');
        toolbar.innerHTML = '';
        theme.tools.forEach((tool, index) => {
            const btn = document.createElement('div');
            btn.className = 'tool-btn';
            if (index === 0) { 
                btn.classList.add('active');
                currentTool = tool;
            }
            btn.innerHTML = `${tool.icon}<div class="tool-label">${tool.label}</div>`;
            btn.onclick = () => selectTool(tool, btn);
            toolbar.appendChild(btn);
        });
    }

    function selectTool(tool, btnElement) {
        currentTool = tool;
        document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
        btnElement.classList.add('active');
        playTone('select');
    }

    function goBack() {
        document.getElementById('game-interface').style.display = 'none';
        document.getElementById('main-menu').style.display = 'flex';
        currentThemeId = '';
    }

    function clearCanvas(resetBg = true) {
        if (!currentThemeId) return;
        ctx.fillStyle = themes[currentThemeId].bg;
        ctx.fillRect(0, 0, width, height);
        if(!resetBg) playTone('select');
    }

    // --- ç¹ªåœ–è™•ç† ---
    let isDrawing = false;
    function draw(x, y) {
        if (!currentTool) return;
        const jitter = 5; 
        x += (Math.random() - 0.5) * jitter;
        y += (Math.random() - 0.5) * jitter;

        playTone('draw');

        if (currentTool.type === 'stamp') {
            if (Math.random() > 0.15) return; 
            const finalSize = currentTool.size * sizeMultiplier;
            ctx.font = `${finalSize}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(currentTool.icon, x, y);
        } 
        else if (currentTool.type === 'text') {
             if (Math.random() > 0.05) return;
            const finalSize = 40 * sizeMultiplier;
            ctx.font = `bold ${finalSize}px Microsoft JhengHei`;
            ctx.fillStyle = currentTool.color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowColor = "black";
            ctx.shadowBlur = 4;
            ctx.fillText(currentTool.content, x, y);
            ctx.shadowBlur = 0;
        }
        else if (currentTool.type === 'brush') {
            ctx.beginPath();
            const finalWidth = currentTool.width * sizeMultiplier;
            ctx.arc(x, y, finalWidth, 0, Math.PI * 2);
            ctx.fillStyle = currentTool.color;
            ctx.shadowBlur = 10 * sizeMultiplier;
            ctx.shadowColor = currentTool.color;
            ctx.fill();
            ctx.shadowBlur = 0;
        }
    }

    function handleStart(x, y) { isDrawing = true; draw(x, y); }
    function handleMove(x, y) { if (isDrawing) draw(x, y); }
    function handleEnd() { isDrawing = false; }

    canvas.addEventListener('mousedown', e => handleStart(e.clientX, e.clientY));
    canvas.addEventListener('mousemove', e => handleMove(e.clientX, e.clientY));
    canvas.addEventListener('mouseup', handleEnd);

    canvas.addEventListener('touchstart', e => {
        e.preventDefault();
        for (let i = 0; i < e.touches.length; i++) handleStart(e.touches[i].clientX, e.touches[i].clientY);
    }, {passive: false});

    canvas.addEventListener('touchmove', e => {
        e.preventDefault();
        for (let i = 0; i < e.touches.length; i++) handleMove(e.touches[i].clientX, e.touches[i].clientY);
    }, {passive: false});

    function saveCard() {
        const link = document.createElement('a');
        link.download = `card-${currentThemeId}.png`;
        link.href = canvas.toDataURL();
        link.click();
        playTone('select');
    }
    
    resize();
</script>
</body>
</html>
